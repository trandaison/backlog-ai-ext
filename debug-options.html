<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Options Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .warning { background: #fff3e0; border-left: 4px solid #ff9800; }

        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîß Options Page Debug</h1>

    <div class="debug-section">
        <h3>üìã Test Results</h3>
        <div id="testResults">Running tests...</div>
    </div>

    <div class="debug-section">
        <h3>üñºÔ∏è Options Page Preview</h3>
        <iframe id="optionsFrame" src="dev-build/optionsNew.html"></iframe>
    </div>

    <div class="debug-section">
        <h3>üìä Console Logs</h3>
        <div id="consoleLogs">
            <p>Monitoring console output...</p>
        </div>
    </div>

    <script>
        // Capture console logs
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };

        const logs = [];
        const logElement = document.getElementById('consoleLogs');

        function addLog(type, message) {
            logs.push({type, message, time: new Date().toLocaleTimeString()});
            updateLogDisplay();
        }

        function updateLogDisplay() {
            logElement.innerHTML = logs.map(log =>
                `<div class="${log.type}"><strong>[${log.time}] ${log.type.toUpperCase()}:</strong> ${log.message}</div>`
            ).join('');
        }

        console.log = (...args) => {
            originalConsole.log(...args);
            addLog('log', args.join(' '));
        };

        console.error = (...args) => {
            originalConsole.error(...args);
            addLog('error', args.join(' '));
        };

        console.warn = (...args) => {
            originalConsole.warn(...args);
            addLog('warn', args.join(' '));
        };

        // Test functions
        async function testFileExistence() {
            const files = [
                'dev-build/optionsNew.html',
                'dev-build/optionsNew.js',
                'dev-build/vendors.js'
            ];

            const results = [];

            for (const file of files) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    results.push(`‚úÖ ${file} - ${response.status}`);
                } catch (error) {
                    results.push(`‚ùå ${file} - ${error.message}`);
                }
            }

            return results;
        }

        async function testJavaScriptExecution() {
            return new Promise((resolve) => {
                const iframe = document.getElementById('optionsFrame');
                let timeoutId;

                iframe.onload = () => {
                    clearTimeout(timeoutId);

                    setTimeout(() => {
                        try {
                            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                            const root = iframeDoc.getElementById('options-root');

                            if (!root) {
                                resolve('‚ùå React root element not found');
                                return;
                            }

                            if (root.children.length === 0) {
                                resolve('‚ùå React root is empty - JavaScript not executed');
                                return;
                            }

                            resolve('‚úÖ React app rendered successfully');
                        } catch (error) {
                            resolve(`‚ùå Cannot access iframe: ${error.message}`);
                        }
                    }, 2000); // Wait 2 seconds for React to render
                };

                // Timeout after 5 seconds
                timeoutId = setTimeout(() => {
                    resolve('‚ùå Iframe load timeout');
                }, 5000);
            });
        }

        // Run tests
        async function runAllTests() {
            const testResults = document.getElementById('testResults');
            testResults.innerHTML = '<p>üîÑ Running tests...</p>';

            try {
                console.log('Starting debug tests...');

                // Test 1: File existence
                console.log('Testing file existence...');
                const fileResults = await testFileExistence();

                // Test 2: JavaScript execution
                console.log('Testing JavaScript execution...');
                const jsResult = await testJavaScriptExecution();

                // Display results
                const allResults = [
                    '<h4>üìÅ File Existence:</h4>',
                    ...fileResults.map(r => `<p>${r}</p>`),
                    '<h4>‚öôÔ∏è JavaScript Execution:</h4>',
                    `<p>${jsResult}</p>`
                ];

                testResults.innerHTML = allResults.join('');

                console.log('All tests completed');

            } catch (error) {
                testResults.innerHTML = `<p class="error">‚ùå Test failed: ${error.message}</p>`;
                console.error('Test execution failed:', error);
            }
        }

        // Start tests when page loads
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>

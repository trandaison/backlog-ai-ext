<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Content Script - Ticket Summary Feature</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }
        .ticket-content {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .ticket-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .ticket-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #666;
        }
        .ticket-description {
            line-height: 1.6;
            color: #444;
        }
        .status-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .priority-high {
            background: #ffebee;
            color: #d32f2f;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        /* Simulate Backlog layout */
        #container {
            display: flex;
            position: relative;
        }
        .main-content {
            flex: 1;
        }
        /* Toggle button simulation */
        .demo-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #007acc;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
    <link rel="stylesheet" href="dev-build/sidebar-styles.css">
</head>
<body>
    <div class="demo-info">
        üì± Demo: Content Script Sidebar
    </div>

    <div id="container">
        <div class="main-content">
            <!-- Simulated Backlog Ticket -->
            <div class="ticket-content">
                <h1 class="ticket-title loom-issue-title">BUG-123: Login page shows blank screen on mobile Safari</h1>

                <div class="ticket-meta">
                    <span>Status: <span class="status-badge">In Progress</span></span>
                    <span>Priority: <span class="priority-high">High</span></span>
                    <span>Assignee: john.doe@company.com</span>
                    <span>Due: 2025-01-30</span>
                </div>

                <div class="ticket-description loom-issue-description">
                    <h3>Description</h3>
                    <p>Users are reporting that the login page shows a completely blank screen when accessing the application from mobile Safari (iOS 17+). This issue seems to be specific to Safari and doesn't occur on Chrome mobile or desktop browsers.</p>

                    <h4>Steps to Reproduce:</h4>
                    <ol>
                        <li>Open Safari on iOS device (tested on iPhone 14, iOS 17.2)</li>
                        <li>Navigate to https://app.company.com/login</li>
                        <li>Page loads but shows blank white screen</li>
                        <li>No error messages visible, console shows some JS errors</li>
                    </ol>

                    <h4>Expected Behavior:</h4>
                    <p>Login form should display properly with username/password fields and login button.</p>

                    <h4>Technical Notes:</h4>
                    <p>Initial investigation suggests this might be related to CSS Grid support or JavaScript ES6 modules. The mobile Safari version might not be handling our webpack bundle correctly.</p>

                    <h4>Comments:</h4>
                    <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 4px solid #007acc;">
                        <strong>user.tester@company.com</strong> - Jan 25, 2025<br>
                        This is blocking our mobile users completely. Can we prioritize this?
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 4px solid #28a745;">
                        <strong>john.doe@company.com</strong> - Jan 25, 2025<br>
                        Started investigation. Looking into webpack bundle compatibility with Safari. Will test with polyfills.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mock chrome APIs -->
    <script>
        // Mock chrome.storage API for testing
        window.chrome = {
            storage: {
                sync: {
                    get: function(keys, callback) {
                        // Mock some basic settings
                        const mockData = {
                            encryptedApiKey: 'mock-encrypted-key',
                            userRole: 'developer',
                            language: 'vi',
                            aiModel: 'gpt-3.5-turbo',
                            backlogConfigs: [
                                {
                                    id: 'demo-config',
                                    domain: 'backlogtool.com',
                                    spaceName: 'yourspace',
                                    apiKey: 'mock-api-key'
                                }
                            ]
                        };
                        callback(mockData);
                    },
                    set: function(data, callback) {
                        console.log('Mock storage set:', data);
                        if (callback) callback();
                    }
                }
            },
            runtime: {
                sendMessage: function(message, callback) {
                    console.log('Mock chrome.runtime.sendMessage:', message);

                    // Mock response for different actions
                    if (message.action === 'requestTicketSummary') {
                        // Simulate processing delay
                        setTimeout(() => {
                            const mockSummary = `**V·∫•n ƒë·ªÅ ch√≠nh:** Trang login hi·ªÉn th·ªã m√†n h√¨nh tr·∫Øng tr√™n mobile Safari iOS 17+, nghi ng·ªù do CSS Grid ho·∫∑c ES6 modules kh√¥ng t∆∞∆°ng th√≠ch.

**Tr·∫°ng th√°i hi·ªán t·∫°i:** ƒêang ƒë∆∞·ª£c x·ª≠ l√Ω v·ªõi priority cao b·ªüi john.doe@company.com.

**ƒêi·ªÉm quan tr·ªçng c·∫ßn l∆∞u √Ω:**
- Ch·ªâ ·∫£nh h∆∞·ªüng Safari mobile, Chrome mobile ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
- C√≥ th·ªÉ li√™n quan ƒë·∫øn webpack bundle compatibility
- User experience b·ªã ·∫£nh h∆∞·ªüng nghi√™m tr·ªçng

**Next steps:** Ki·ªÉm tra CSS Grid fallback, test ES6 polyfills cho Safari mobile, v√† validate webpack configuration.`;

                            if (callback) callback({
                                success: true,
                                summary: mockSummary
                            });
                        }, 2000);
                        return;
                    }

                    if (message.action === 'getBacklogSettings') {
                        if (callback) callback({
                            configs: [
                                {
                                    id: 'demo-config',
                                    domain: 'backlogtool.com',
                                    spaceName: 'yourspace',
                                    apiKey: 'mock-api-key-12345'
                                }
                            ]
                        });
                        return;
                    }

                    if (callback) callback({success: true});
                },
                getURL: function(path) {
                    return 'dev-build/' + path;
                }
            },
            scripting: {
                executeScript: function(details, callback) {
                    // Mock scripting API
                    console.log('Mock chrome.scripting.executeScript:', details);
                    if (callback) callback([{result: null}]);
                }
            }
        };

        // Mock window.location for space extraction
        Object.defineProperty(window, 'location', {
            value: {
                href: 'https://yourspace.backlogtool.com/view/BUG-123',
                pathname: '/view/BUG-123'
            },
            writable: true
        });

        // Mock the ticket extraction function
        window.extractTicketData = function() {
            return {
                id: 'BUG-123',
                title: 'Login page shows blank screen on mobile Safari',
                description: 'Users are reporting that the login page shows a completely blank screen when accessing the application from mobile Safari (iOS 17+). This issue seems to be specific to Safari and doesn\'t occur on Chrome mobile or desktop browsers.',
                status: 'In Progress',
                priority: 'High',
                assignee: 'john.doe@company.com',
                reporter: 'user.tester@company.com',
                dueDate: '2025-01-30',
                labels: ['bug', 'mobile', 'safari'],
                comments: [
                    {
                        author: 'user.tester@company.com',
                        content: 'This is blocking our mobile users completely. Can we prioritize this?',
                        timestamp: '2025-01-25 09:30:00'
                    },
                    {
                        author: 'john.doe@company.com',
                        content: 'Started investigation. Looking into webpack bundle compatibility with Safari. Will test with polyfills.',
                        timestamp: '2025-01-25 14:15:00'
                    }
                ]
            };
        };

        console.log('Test environment loaded. Content script sidebar will be injected.');
    </script>

    <!-- Load content script to inject the sidebar -->
    <script src="dev-build/content.js"></script>
</body>
</html>
